{% extends "base.html" %}
{% block content %}
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div class="bg-white border rounded-xl overflow-hidden">
      <div class="px-4 py-3 border-b flex items-center justify-between gap-3">
        <div class="font-medium">邮件详情</div>
        <div class="text-xs text-slate-500">ID: {{ email_id }}</div>
      </div>

      <div class="p-4 space-y-3">
        <div>
          <div class="text-[11px] uppercase tracking-wide text-slate-500">Subject</div>
          <div class="text-lg font-semibold tracking-tight leading-snug break-words">{{ email.subject or "(no subject)" }}</div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <div class="text-[11px] uppercase tracking-wide text-slate-500">From</div>
            <div class="text-sm text-slate-800 break-words">{{ email["from"] or "(unknown)" }}</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-wide text-slate-500">Date</div>
            <div class="text-sm text-slate-800 break-words">{{ email.date or "-" }}</div>
          </div>
        </div>

        <div>
          <div class="text-[11px] uppercase tracking-wide text-slate-500">Body</div>
          <div class="mt-2 border rounded-lg p-4 bg-slate-50 whitespace-pre-wrap break-words max-h-[360px] overflow-auto text-base leading-relaxed text-slate-900">
            {{ email.body_text or "" }}
          </div>
        </div>

        <div>
          <div class="text-xs text-slate-500">Attachments</div>
          {% if email.attachments and email.attachments|length > 0 %}
            <ul class="list-disc pl-5">
              {% for a in email.attachments %}
                <li class="break-words">
                  {{ a.filename or "file" }}
                  {% if a.saved_to %}
                    {% set rel = a.saved_to.replace("out/attachments/", "") %}
                    <a class="text-sky-700 underline" href="/attachments/{{ rel }}" target="_blank">打开</a>
                  {% endif %}
                  {% if a.error %}<span class="text-rose-700">（下载失败：{{ a.error }}）</span>{% endif %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="text-slate-600">无</div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="bg-white border rounded-xl overflow-hidden">
      <div class="px-4 py-3 border-b flex items-center justify-between gap-3">
        <div class="font-medium">Triage</div>
        <button
          class="px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500"
          hx-post="{{ request.url_for('api_triage_run', email_id=email_id) }}"
          hx-target="#triage-section"
          hx-swap="outerHTML"
        >
          Run Triage
        </button>
      </div>

      {% include "partials/triage_section.html" %}
    </div>
  </div>
{% endblock %}

