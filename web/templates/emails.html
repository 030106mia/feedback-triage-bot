{% extends "base.html" %}
{% block content %}
  <div class="bg-white border rounded-xl overflow-hidden">
    <div class="px-4 py-4 border-b">
      <div class="flex flex-wrap items-start justify-between gap-3">
        <div class="space-y-1">
          <div class="text-lg font-semibold">收件箱 · 反馈分流</div>
          <div class="text-sm text-slate-600">默认隐藏已处理。用筛选可查看历史。</div>
        </div>
        <a href="/" class="px-3 py-2 rounded-lg bg-white border hover:bg-slate-50 text-sm">返回 Setup</a>
      </div>

      <form class="mt-4 flex flex-wrap items-end gap-2" method="get" action="/emails">
        <div class="min-w-[220px] flex-1">
          <label class="text-xs text-slate-500">搜索</label>
          <input name="q" class="mt-1 w-full border rounded-lg px-3 py-2" value="{{ q }}" placeholder="主题 / 发件人" />
        </div>
        <div>
          <label class="text-xs text-slate-500">状态</label>
          <select name="status" class="mt-1 border rounded-lg px-3 py-2">
            <option value="active" {% if status=='active' %}selected{% endif %}>待处理 + 无需处理</option>
            <option value="pending" {% if status=='pending' %}selected{% endif %}>待处理</option>
            <option value="ignore" {% if status=='ignore' %}selected{% endif %}>无需处理</option>
            <option value="processed" {% if status=='processed' %}selected{% endif %}>已处理</option>
            <option value="all" {% if status=='all' %}selected{% endif %}>全部</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-500">开始</label>
          <input name="date_from" type="datetime-local" class="mt-1 border rounded-lg px-3 py-2" value="{{ date_from }}" />
        </div>
        <div>
          <label class="text-xs text-slate-500">结束</label>
          <input name="date_to" type="datetime-local" class="mt-1 border rounded-lg px-3 py-2" value="{{ date_to }}" />
        </div>
        <button class="px-3 py-2 rounded-lg bg-slate-900 text-white hover:bg-slate-800" type="submit">应用</button>
      </form>
    </div>

    {% if emails|length == 0 %}
      <div class="p-6 space-y-3 text-slate-700">
        <div class="text-base font-medium">当前筛选下为空</div>
        <div class="text-sm text-slate-600">回到首页点击「手动拉取并解析」开始工作流。</div>
        <a href="/" class="inline-flex px-3 py-2 rounded-lg bg-slate-900 text-white hover:bg-slate-800 text-sm">去首页</a>
      </div>
    {% else %}
      <div class="px-4 py-3 border-b text-sm text-slate-600">
        共 {{ total }} 封 · 每页 {{ page_size }}
      </div>

      <div class="divide-y">
        {% for e in emails %}
          {% include "partials/email_row.html" %}
        {% endfor %}
      </div>

      <div class="px-4 py-3 border-t flex items-center justify-between text-sm">
        <div>第 {{ page }} / {{ total_pages }} 页</div>
        <div class="flex items-center gap-2">
          {% if page > 1 %}
            <a class="px-3 py-2 rounded-lg bg-white border hover:bg-slate-50" href="/emails?q={{ q }}&status={{ status }}&date_from={{ date_from }}&date_to={{ date_to }}&page={{ page - 1 }}">上一页</a>
          {% endif %}
          {% if page < total_pages %}
            <a class="px-3 py-2 rounded-lg bg-white border hover:bg-slate-50" href="/emails?q={{ q }}&status={{ status }}&date_from={{ date_from }}&date_to={{ date_to }}&page={{ page + 1 }}">下一页</a>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}

